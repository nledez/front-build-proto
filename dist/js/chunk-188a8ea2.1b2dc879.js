(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-188a8ea2"],{5715:function(e,t,r){},"73d3":function(e,t,r){},9751:function(e,t,r){"use strict";var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e.label.length>0?r("label",{staticClass:"label"},[e._v(" "+e._s(e.label)+" ")]):e._e(),r("div",{class:{combo:!0,open:e.showList},on:{click:e.toggleList}},[r("div",{staticClass:"flexrow"},[r("div",{staticClass:"selected-line flexrow-item"},[e._v(" "+e._s(e.selectedOption?e.selectedOption.label:"")+" ")]),r("chevron-down-icon",{staticClass:"down-icon flexrow-item"})],1),e.showList?r("div",{ref:"select",staticClass:"select-input",on:{click:e.toggleList}},e._l(e.options,(function(t){return r("div",{key:t.id,staticClass:"option-line",on:{click:function(r){return e.selectOption(t)},mouseup:function(r){return"button"in r&&1!==r.button?null:e.openRoute(t)}}},[e._v(" "+e._s(t.label)+" ")])})),0):e._e()]),r("div",{class:{"c-mask":!0,"is-active":e.showList},on:{click:e.toggleList}})])},n=[],s=r("2f62"),a=r("0a35");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var u={name:"combobox-styled",components:{ChevronDownIcon:a["j"]},data:function(){return{selectedOption:{label:"",value:""},showList:!1}},props:{label:{default:"",type:String},options:{default:function(){return[]},type:Array},value:{default:"",type:String}},mounted:function(){this.options.length>0&&(this.selectedOption=this.options[0])},computed:c({},Object(s["c"])(["isDarkTheme"])),methods:{selectOption:function(e){this.$emit("input",e.value),this.selectedOption=e,this.toggleList()},openRoute:function(e){var t=this.$router.resolve(e.route).href,r="".concat(window.location.protocol,"//").concat(window.location.host).concat(t);window.open(r,"_blank")},toggleList:function(){this.showList=!this.showList}},watch:{options:function(){var e=this;if(this.options.length>0){var t=this.options.find((function(t){return t.value===e.value}));this.selectedOption=t||this.options[0]}},value:function(){var e=this;this.selectedOption=this.options.find((function(t){return t.value===e.value}))}}},l=u,m=(r("e861"),r("2877")),h=Object(m["a"])(l,i,n,!1,null,"597e1434",null);t["a"]=h.exports},"99a3":function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"fixed-page columns"},[r("div",{staticClass:"page column main-column"},[r("div",{staticClass:"page-header pa1"},[e.currentTask?r("div",{staticClass:"flexrow header-title"},[e.currentTaskType?r("task-type-name",{staticClass:"flexrow-item task-type block",attrs:{"task-type":e.currentTaskType,"production-id":e.currentProduction.id}}):e._e(),r("span",{staticClass:"flexrow-item ml2"},[r("entity-thumbnail",{staticClass:"entity-thumbnail",attrs:{entity:e.currentTaskPreviews&&e.currentTaskPreviews.length>0?{preview_file_id:e.currentTaskPreviews[0].id}:{},"empty-width":100,"empty-height":60,width:100,"with-link":!1}})],1),r("div",{staticClass:"title flexrow-item"},[r("router-link",{attrs:{to:e.taskEntityPath}},[r("page-title",{attrs:{text:e.currentTask?e.title:"Loading...",bold:""}})],1)],1),r("div",{staticClass:"filler"}),r("div",{staticClass:"has-text-right block"},[e._v(" "+e._s(e.$t("tasks.fields.priority"))+": "+e._s(e.formatPriority(e.currentTask.priority))+" ")])],1):e._e(),e.currentTask?r("div",{staticClass:"flexrow block mt1 mb1"},[r("span",{staticClass:"flexrow-item"},[e._v(e._s(e.$t("tasks.current_status")))]),e.currentTask?r("validation-tag",{staticClass:"is-medium flexrow-item",attrs:{task:e.currentTask,"is-static":!0}}):e._e(),e.currentTask.assignees.length>0?r("span",{staticClass:"flexrow-item"},[e._v(" "+e._s(e.$t("tasks.fields.assignees"))+": ")]):e._e(),e._l(e.currentTask.assignees,(function(t){return r("span",{key:t,staticClass:"flexrow-item avatar-wrapper"},[r("people-avatar",{key:t,staticClass:"flexrow-item",attrs:{person:e.personMap.get(t),size:30,"font-size":16}})],1)})),r("div",{staticClass:"filler"}),e.isAssigned?e._e():r("subscribe-button",{staticClass:"flexrow-item action-button",attrs:{subscribed:e.isAssigned||e.isSubscribed},on:{click:e.toggleSubscribe}})],2):e._e()]),r("div",{ref:"task-columns",staticClass:"task-columns"},[r("div",{staticClass:"task-column preview-column"},[r("div",{staticClass:"preview-column-content block"},[r("div",{staticClass:"flexrow preview-header"},[e.isPreviews?r("div",{staticClass:"flexrow-item"},[r("combobox-styled",{staticClass:"preview-combo flexrow-item",attrs:{options:e.previewOptions},model:{value:e.selectedPreviewId,callback:function(t){e.selectedPreviewId=t},expression:"selectedPreviewId"}})],1):r("div",[r("em",[e._v(" "+e._s(e.$t("tasks.no_preview"))+" ")])]),e.isPreviewButtonVisible?r("div",{staticClass:"set-main-preview flexrow-item flexrow pull-right"},[e.isPreviews&&e.isCurrentUserManager?r("button",{class:{button:!0,"flexrow-item":!0,"is-loading":e.loading.setPreview},on:{click:e.setPreview}},[r("image-icon",{staticClass:"icon"}),r("span",{staticClass:"text"},[e._v(" "+e._s(e.$t("tasks.set_preview"))+" ")])],1):e._e(),e.errors.setPreview?r("span",{staticClass:"error flexrow-item"},[e._v(" "+e._s(e.$t("tasks.set_preview_error"))+" ")]):e._e()]):e._e(),e.currentTask&&e.currentTask.entity&&e.currentTask.entity.preview_file_id===e.currentPreviewId?r("div",{staticClass:"set-main-preview flexrow-item pull-right"},[r("em",[e._v(e._s(e.$t("tasks.set_preview_done")))])]):e._e()]),r("div",{staticClass:"preview-area mt1"},[e.isPreviews?r("div",[e.currentPreview?r("preview-player",{ref:"preview-player",attrs:{previews:e.currentPreview.previews,"task-type-map":e.taskTypeMap,"entity-preview-files":e.taskEntityPreviews,"read-only":e.isCurrentUserArtist,"last-preview-files":e.lastFivePreviews,task:e.currentTask,"extra-wide":!0},on:{"annotation-changed":e.onAnnotationChanged,"add-extra-preview":e.onAddExtraPreviewClicked,"remove-extra-preview":e.onRemoveExtraPreviewClicked,"change-current-preview":e.changeCurrentPreview,"time-updated":e.onTimeUpdated}}):e._e()],1):e._e()])]),r("div",{staticClass:"flexrow-item block mt1 mr0 info-block"},[r("page-subtitle",{attrs:{text:e.$t("main.info")}}),r("div",{staticClass:"table-body mt1"},[e.currentTask?r("table",{staticClass:"datatable"},[r("tbody",{staticClass:"table-body"},[r("tr",{staticClass:"datatable-row"},[r("td",{staticClass:"field-label"},[e._v(e._s(e.$t("tasks.fields.estimation")))]),r("td",[e._v(e._s(e.currentTask.estimation))])]),r("tr",{staticClass:"datatable-row"},[r("td",{staticClass:"field-label"},[e._v(e._s(e.$t("tasks.fields.duration")))]),r("td",[e._v(e._s(e.formatDuration(e.currentTask.duration)))])]),r("tr",{staticClass:"datatable-row"},[r("td",{staticClass:"field-label"},[e._v(e._s(e.$t("tasks.fields.retake_count")))]),r("td",[e._v(e._s(e.currentTask.retake_count))])]),r("tr",{staticClass:"datatable-row"},[r("td",{staticClass:"field-label"},[e._v(e._s(e.$t("tasks.fields.start_date")))]),r("td",[e._v(e._s(e.formatSimpleDate(e.currentTask.start_date)))])]),r("tr",{staticClass:"datatable-row"},[r("td",{staticClass:"field-label"},[e._v(e._s(e.$t("tasks.fields.due_date")))]),r("td",[e._v(e._s(e.formatSimpleDate(e.currentTask.due_date)))])])])]):e._e()])],1),r("div",{staticClass:"pa2"})]),r("div",{staticClass:"task-column comments-column"},[e.currentTask?r("div",[r("div",[e.isCommentingAllowed?r("add-comment",{ref:"add-comment",attrs:{"is-error":e.errors.addComment,"is-loading":e.loading.addComment,"is-movie":e.isMovie,user:e.user,team:e.currentTeam,task:e.currentTask,"task-status":e.taskStatusForCurrentUser,"attached-file-name":e.attachedFileName,fps:parseInt(e.currentFps),time:e.currentTime,revision:e.currentRevision},on:{"add-comment":e.addComment,"add-preview":e.onAddPreviewClicked,"duplicate-comment":e.onDuplicateComment,"file-drop":e.selectFile,"annotation-snapshots-requested":e.extractAnnotationSnapshots}}):e._e(),e.currentTaskComments&&e.currentTaskComments.length>0?r("div",{staticClass:"comments"},e._l(e.currentTaskComments,(function(t,i){return r("comment",{key:t.id,attrs:{comment:t,task:e.currentTask,highlighted:!1,"current-user":e.user,editable:t.person&&e.user.id===t.person.id||e.isCurrentUserAdmin,"is-first":0===i,"is-last":i===e.pinnedCount,"is-change":e.isStatusChange(i)},on:{"ack-comment":e.ackComment,"pin-comment":e.onPinComment,"edit-comment":e.onEditComment,"delete-comment":e.onDeleteComment,"checklist-updated":e.saveComment,"time-code-clicked":e.timeCodeClicked}})})),1):r("div",{staticClass:"no-comment"},[r("em",[e._v(" "+e._s(e.$t("tasks.no_comment"))+" ")])])],1)]):r("div",{staticClass:"has-text-centered"},[r("spinner")],1)])]),r("add-preview-modal",{ref:"add-preview-modal",attrs:{active:e.modals.addPreview,"is-loading":e.loading.addPreview,"is-error":e.errors.addPreview,"form-data":e.addPreviewFormData},on:{cancel:function(t){e.modals.addPreview=!1},fileselected:e.selectFile,confirm:e.closeAddPreviewModal}}),r("add-preview-modal",{ref:"add-extra-preview-modal",attrs:{active:e.modals.addExtraPreview,"is-loading":e.loading.addExtraPreview,"is-error":e.errors.addExtraPreview,"form-data":e.addExtraPreviewFormData},on:{cancel:e.hideExtraPreviewModal,fileselected:e.selectFile,confirm:e.createExtraPreview}}),r("edit-comment-modal",{attrs:{active:e.modals.editComment,"is-loading":e.loading.editComment,"is-error":e.errors.editComment,"comment-to-edit":e.commentToEdit,team:e.currentTeam},on:{confirm:e.confirmEditTaskComment,cancel:e.onCancelEditComment}}),r("delete-modal",{attrs:{active:e.modals.deleteComment,"is-loading":e.loading.deleteComment,"is-error":e.errors.deleteComment,text:e.$t("tasks.delete_comment"),"error-text":e.$t("tasks.delete_comment_error")},on:{confirm:e.confirmDeleteTaskComment,cancel:e.onCancelDeleteComment}}),r("delete-modal",{attrs:{active:e.modals.deleteExtraPreview,"is-loading":e.loading.deleteExtraPreview,"is-error":e.errors.deleteExtraPreview,text:e.$t("tasks.delete_preview"),"error-text":e.$t("tasks.delete_preview_error")},on:{cancel:e.hideRemoveExtraPreviewModal,confirm:e.confirmDeleteTaskPreview}})],1)])},n=[],s=r("2f62"),a=r("0a35"),o=r("9d8b"),c=r("1b25"),d=r("31f2"),u=r("6be5"),l=r("ee35"),m=r("8bd9"),h=r("9751"),v=r("5f48"),f=r("5b23"),p=r("bb21"),w=r("8d07"),k=r("8751"),g=r("eb8c"),T=r("be83"),y=r("d228"),C=r("274f"),P=r("fe13"),_=r("6aac");function b(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */b=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},n=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function o(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{o({},"")}catch(E){o=function(e,t,r){return e[t]=r}}function c(e,t,r,i){var n=t&&t.prototype instanceof l?t:l,s=Object.create(n.prototype),a=new P(i||[]);return s._invoke=function(e,t,r){var i="suspendedStart";return function(n,s){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===n)throw s;return x()}for(r.method=n,r.arg=s;;){var a=r.delegate;if(a){var o=T(a,r);if(o){if(o===u)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===i)throw i="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i="executing";var c=d(e,t,r);if("normal"===c.type){if(i=r.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i="completed",r.method="throw",r.arg=c.arg)}}}(e,r,a),s}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(E){return{type:"throw",arg:E}}}e.wrap=c;var u={};function l(){}function m(){}function h(){}var v={};o(v,n,(function(){return this}));var f=Object.getPrototypeOf,p=f&&f(f(_([])));p&&p!==t&&r.call(p,n)&&(v=p);var w=h.prototype=l.prototype=Object.create(v);function k(e){["next","throw","return"].forEach((function(t){o(e,t,(function(e){return this._invoke(t,e)}))}))}function g(e,t){function i(n,s,a,o){var c=d(e[n],e,s);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==O(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){i("next",e,a,o)}),(function(e){i("throw",e,a,o)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return i("throw",e,a,o)}))}o(c.arg)}var n;this._invoke=function(e,r){function s(){return new t((function(t,n){i(e,r,t,n)}))}return n=n?n.then(s,s):s()}}function T(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var n=i.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function y(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(y,this),this.reset(!0)}function _(e){if(e){var t=e[n];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function t(){for(;++i<e.length;)if(r.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return s.next=s}}return{next:x}}function x(){return{value:void 0,done:!0}}return m.prototype=h,o(w,"constructor",h),o(h,"constructor",m),m.displayName=o(h,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,o(e,a,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},k(g.prototype),o(g.prototype,s,(function(){return this})),e.AsyncIterator=g,e.async=function(t,r,i,n,s){void 0===s&&(s=Promise);var a=new g(c(t,r,i,n),s);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},k(w),o(w,a,"Generator"),o(w,n,(function(){return this})),o(w,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var i=t.pop();if(i in e)return r.value=i,r.done=!1,r}return r.done=!0,r}},e.values=_,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(r,i){return a.type="throw",a.arg=e,t.next=r,i&&(t.method="next",t.arg=void 0),!!i}for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var o=r.call(s,"catchLoc"),c=r.call(s,"finallyLoc");if(o&&c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(o){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var s=n;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;C(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:_(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},e}function x(e,t,r,i,n,s,a){try{var o=e[s](a),c=o.value}catch(d){return void r(d)}o.done?t(c):Promise.resolve(c).then(i,n)}function E(e){return function(){var t=this,r=arguments;return new Promise((function(i,n){var s=e.apply(t,r);function a(e){x(s,i,n,a,o,"next",e)}function o(e){x(s,i,n,a,o,"throw",e)}a(void 0)}))}}function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach((function(t){I(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function I(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var $={name:"task",mixins:[d["a"]],components:{AddComment:u["a"],AddPreviewModal:l["a"],ComboboxStyled:h["a"],Comment:m["a"],DeleteModal:v["a"],EditCommentModal:f["a"],EntityThumbnail:p["a"],ImageIcon:a["E"],PageSubtitle:k["a"],PageTitle:w["a"],PeopleAvatar:g["a"],PreviewPlayer:_["a"],Spinner:T["a"],SubscribeButton:y["a"],TaskTypeName:C["a"],ValidationTag:P["a"]},data:function(){return{attachedFileName:"",currentTime:0,selectedTab:"validation",taskLoading:{isLoading:!0,isError:!1},modals:{addPreview:!1,addExtraPreview:!1,deleteExtraPreview:!1,deleteTask:!1,deleteComment:!1,editComment:!1},loading:{addComment:!1,addPreview:!1,addExtraPreview:!1,setPreview:!1,deleteTask:!1,deleteComment:!1,editComment:!1},errors:{addComment:!1,addPreview:!1,addExtraPreview:!1,setPreview:!1,deleteTask:!1,deleteComment:!1,editComment:!1},addPreviewFormData:null,addExtraPreviewFormData:null,currentTask:null,currentTaskComments:[],currentTaskPreviews:[],commentToEdit:null,isSubscribed:!1,selectedPreviewId:null}},created:function(){this.clearSelectedTasks(),this.loadTaskData()},mounted:function(){var e=this;this.reset(),this.$nextTick((function(){e.$refs["task-columns"]&&(e.$refs["task-columns"].scrollTop=100,window.scrollTo(0,0))}))},beforeDestroy:function(){if(this.$refs["add-comment"]){var e="".concat(this.$refs["add-comment"].text);c["a"].setTaskDraft(this.currentTask.id,e)}},computed:S(S({},Object(s["c"])(["currentEpisode","currentProduction","displayedShots","displayedAssets","getTaskComments","getTaskPreviews","getTaskComment","isCurrentUserAdmin","isCurrentUserArtist","isCurrentUserSupervisor","isCurrentUserClient","isCurrentUserManager","isSingleEpisode","isTVShow","personMap","productionMap","route","taskEntityPreviews","taskStatus","taskStatusForCurrentUser","taskMap","taskTypeMap","user"])),{},{previewOptions:function(){return this.currentTaskPreviews.map((function(e){return{label:"v".concat(e.revision),value:e.id}}))},isPreviewButtonVisible:function(){return this.isCurrentUserManager&&this.currentTask&&this.currentTask.entity&&this.currentTask.entity.preview_file_id!==this.currentPreviewId&&["png","mp4"].includes(this.extension)},isMovie:function(){return"mp4"===this.extension},extension:function(){return this.currentPreview?this.currentPreview.extension:""},currentPreviewId:function(){return this.currentPreview?this.currentPreview.id:""},currentPreview:function(){if(this.isPreviews){var e=this.currentTaskPreviews[0],t=this.route.params.preview_id;return this.selectedPreviewId&&(e=this.currentTaskPreviews.find((function(e){return e.id===t}))),e}return null},currentFps:function(){return this.productionMap.get(this.currentTask.project_id).fps||"25"},currentRevision:function(){return this.currentPreview?this.currentPreview.revision:0},isCommentingAllowed:function(){var e=this;return this.isCurrentUserManager||this.isCurrentUserClient||this.currentTask.assignees.find((function(t){return t===e.user.id}))},taskTypeBorder:function(){var e="transparent";return this.currentTask&&(e=this.currentTask.task_type_color),{"border-left":"4px solid ".concat(e)}},deleteTaskPath:function(){return this.taskPath(this.currentTask,"task-delete")},isPreviews:function(){return this.currentTaskPreviews&&this.currentTaskPreviews.length>0},taskEntityPath:function(){if(this.currentTask){var e=this.currentEpisode?this.currentEpisode.id:this.$route.params.episode_id;return Object(o["g"])(this.currentTask,e)}return{name:"open-productions"}},lastFivePreviews:function(){return this.currentTaskPreviews?this.currentTaskPreviews.slice(0,5):[]},entityList:function(){var e=this,t=this.displayedShots.find((function(t){return t.id===e.currentTask.entity_id}));return t?this.displayedShots:this.displayedAssets},previousEntity:function(){var e=this;if(!this.currentTask)return{name:"open-productions"};var t=function(){var t=e.currentTask.task_type_id,r=e.entityList.findIndex((function(t){return t.id===e.currentTask.entity_id})),i=!1,n=r-1;n<0&&(n=e.entityList.length-1);var s=null;while(!s){if(e.entityList[n]){var a=e.entityList[n];s=a.tasks.find((function(r){var i=e.taskMap.get(s);return!!i&&i.task_type_id===t}))}else s=e.currentTask.id;if(!s&&(n--,n<0)){if(n=e.entityList.length,i)return{v:null};i=!0}}return{v:e.taskPath({id:s})}}();return"object"===O(t)?t.v:void 0},nextEntity:function(){var e=this;if(!this.currentTask)return{name:"open-productions"};var t=function(){var t=e.currentTask.task_type_id,r=!1,i=e.entityList.findIndex((function(t){return t.id===e.currentTask.entity_id})),n=i+1;n>=e.entityList.length&&(n=0);var s=null;while(!s){if(e.entityList[n]){var a=e.entityList[n];s=a.tasks.find((function(r){var i=e.taskMap.get(s);return!!i&&i.task_type_id===t}))}else s=e.currentTask.id;if(!s&&(n++,n>=e.entityList.length)){if(n=0,r)return{v:null};r=!0}}return{v:e.taskPath({id:s})}}();return"object"===O(t)?t.v:void 0},title:function(){if(this.currentTask){var e=this.currentTask.entity_type_name,t=this.currentTask.full_entity_name||this.currentTask.entity_name;return this.isTVShow&&"Shot"===e&&(t=t.split("/").splice(1).join("/")),"".concat(t)}return"Loading..."},windowTitle:function(){if(this.currentTask){var e=this.currentTask.task_type_name;return"".concat(this.title," / ").concat(e)}return"Loading..."},deleteText:function(){if(this.currentTask){var e=this.taskTypeMap.get(this.currentTask.task_type_id);return this.$t("main.delete_text",{name:"".concat(this.currentTask.entity_name," / ").concat(e.name)})}return""},isAssigned:function(){var e=this;return!!this.currentTask&&this.currentTask.assignees.some((function(t){return t===e.user.id}))},currentTaskType:function(){return this.currentTask?this.taskTypeMap.get(this.currentTask.task_type_id):null},currentTeam:function(){var e=this;return this.currentProduction.team.map((function(t){return e.personMap.get(t)}))},pinnedCount:function(){return this.currentTaskComments.filter((function(e){return e.pinned})).length}}),methods:S(S({},Object(s["b"])(["ackComment","addCommentPreview","addCommentExtraPreview","commentTask","commentTaskWithPreview","changeCommentPreview","clearSelectedTasks","deleteTask","deleteTaskPreview","deleteTaskComment","editTaskComment","loadEpisodes","loadTask","loadShots","loadAssets","loadPreviewFileFormData","loadTaskComments","loadTaskSubscribed","refreshComment","refreshPreview","pinComment","subscribeToTask","setCurrentEpisode","unsubscribeFromTask","updatePreviewAnnotation"])),{},{loadTaskData:function(){var e=this,t=this.getCurrentTask();if(t){var r=this.route.params.task_id;this.currentTask=t,this.loadTaskComments({taskId:r,entityId:t.entity_id}).then((function(){return e.loadTaskSubscribed({taskId:r})})).then((function(t){e.isSubscribed=t,e.reset()})).catch((function(t){console.error(t),e.taskLoading.isError=!0}))}else this.taskLoading={isLoading:!0,isError:!1},this.loadTask({taskId:this.route.params.task_id}).then((function(t){var r=function(t){e.loadAssets().then(t)};"Shot"===t.entity_type_name&&(r=function(r){e.loadEpisodes().then((function(){e.isTVShow&&e.setCurrentEpisode(t.episode.id),e.loadShots(r)})).catch(r)}),r((function(){e.currentTask=t,e.loadTaskComments({taskId:t.id,entityId:t.entity_id}).then((function(){return e.loadTaskSubscribed({taskId:t.id})})).then((function(t){e.isSubscribed=t,e.reset(),e.taskLoading={isLoading:!1,isError:!1}})).catch((function(t){console.error(t),e.taskLoading={isLoading:!1,isError:!0}}))}))}))},getCurrentTask:function(){return this.taskMap.get(this.route.params.task_id)},getCurrentComment:function(){if(this.route.params.comment_id)return this.getTaskComment(this.route.params.task_id,this.route.params.comment_id)},getCurrentTaskComments:function(){return this.getTaskComments(this.route.params.task_id)},getCurrentTaskPreviews:function(){return this.getTaskPreviews(this.route.params.task_id)},addComment:function(e,t,r,i){var n=this,s={taskId:this.currentTask.id,taskStatusId:i,comment:e,checklist:r,attachment:t},a="commentTask";this.attachedFileName&&(a="commentTaskWithPreview"),this.loading.addComment=!0,this.errors.addComment=!1,this.$store.dispatch(a,s).then((function(){n.currentTaskPreviews=n.getCurrentTaskPreviews(),n.resetPreview(),n.$refs["add-preview-modal"].reset(),n.reset(),n.attachedFileName="",n.loading.addComment=!1})).catch((function(e){console.error(e),n.errors.addComment=!0,n.loading.addComment=!1}))},reset:function(){var e=this;this.currentTaskComments=this.getCurrentTaskComments(),this.currentTaskPreviews=this.getCurrentTaskPreviews(),this.currentTask=this.getCurrentTask();var t=c["a"].getTaskDraft(this.currentTask.id);t&&(this.$refs["add-comment"].text=t),setTimeout((function(){e.$route.params.preview_id&&(e.selectedPreviewId=e.$route.params.preview_id)}),1e3)},selectFile:function(e){this.loadPreviewFileFormData(e),this.attachedFileName=e.map((function(e){return e.get("file").name})).join(", ")},isHighlighted:function(e){return e.preview&&e.preview.id===this.currentPreviewId},createExtraPreview:function(){var e=this,t=this.currentTaskPreviews,r=t.length>0?t[0]:null;this.errors.addExtraPreview=!1,this.loading.addExtraPreview=!0;var i=this.getCurrentTaskComments().find((function(e){return e.previews.findIndex((function(e){return e.id===r.id}))>=0}));this.addCommentExtraPreview({taskId:this.currentTask.id,previewId:this.currentPreview.id,commentId:i.id}).then((function(){e.loading.addExtraPreview=!1,e.modals.addExtraPreview=!1,e.$refs["add-extra-preview-modal"].reset(),setTimeout((function(){e.$refs["preview-player"].displayLast()}),0)})).catch((function(t){console.error(t),e.errors.addExtraPreview=!0,e.loading.addExtraPreview=!1}))},resetPreview:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.currentTaskPreviews,r=t.length>0?t[0]:null;this.currentTaskComments=this.getCurrentTaskComments(),this.currentTaskPreviews=this.getCurrentTaskPreviews(),r&&e&&this.$router.push(this.previewPath(r.id))},setPreview:function(){var e=this;this.loading.setPreview=!0,this.errors.setPreview=!1,this.$store.dispatch("setPreview",{taskId:this.currentTask.id,entityId:this.currentTask.entity.id,previewId:this.currentPreviewId}).then((function(){e.loading.setPreview=!1})).catch((function(t){console.error(t),e.errors.setPreview=!0}))},confirmEditTaskComment:function(e){var t=this;this.loading.editComment=!0,this.errors.editComment=!1,this.editTaskComment({taskId:this.currentTask.id,comment:e}).then((function(){t.loading.editComment=!1,t.modals.editComment=!1})).catch((function(e){console.error(e),t.errors.editComment=!0}))},saveComment:function(e,t){this.editTaskComment({taskId:this.currentTask.id,comment:e,checklist:t})},confirmDeleteTaskComment:function(){var e=this;this.loading.deleteComment=!0,this.errors.deleteComment=!1;var t=this.commentToEdit.id;this.deleteTaskComment({taskId:this.currentTask.id,commentId:t}).then((function(){e.loading.deleteComment=!1,e.reset(),e.isPreviews&&e.resetPreview(),e.modals.deleteComment=!1})).catch((function(t){console.error(t),e.loading.deleteComment=!1,e.errors.deleteComment=!0}))},confirmDeleteTaskPreview:function(){var e=this;this.loading.deleteExtraPreview=!0,this.errors.deleteExtraPreview=!1;var t=this.currentPreviewId,r=this.getCurrentTaskComments().find((function(e){return e.previews.findIndex((function(e){return e.id===t}))>=0}));this.$refs["preview-player"].displayFirst(),this.deleteTaskPreview({taskId:this.currentTask.id,commentId:r.id,previewId:this.currentExtraPreviewId}).then((function(){e.loading.deleteExtraPreview=!1,e.resetPreview(),e.hideRemoveExtraPreviewModal()})).catch((function(t){console.error(t),e.loading.deleteExtraPreview=!1,e.errors.deleteExtraPreview=!0}))},onPreviewAdded:function(e){var t=e.task_id,r=e.comment_id,i=e.preview_file_id,n=e.revision,s=e.extension,a=this.$store.getters.getTaskComment(t,r);this.currentTask&&a&&(0===a.previews.length||a.previews[0].id!==i)&&t===this.currentTask.id&&(this.$store.commit("ADD_PREVIEW_END",{preview:{id:i,revision:n,extension:s},taskId:t,commentId:r,comment:a}),this.resetPreview())},toggleSubscribe:function(){this.currentTask&&!this.isAssigned&&(this.isSubscribed?(this.unsubscribeFromTask(this.currentTask.id),this.isSubscribed=!1):(this.subscribeToTask(this.currentTask.id),this.isSubscribed=!0))},taskPath:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"task";e?(e.project_id=this.currentTask.project_id,e.episode_id=this.currentTask.episode_id):e=this.currentTask;var r={name:"open-productions"};return e&&(r={name:t,params:{production_id:e.project_id,task_id:e.id}},this.isTVShow&&this.currentEpisode&&(r.name="episode-".concat(t),r.params.episode_id=e.episode_id||this.currentEpisode.id)),r},previewPath:function(e){var t=this.taskPath(this.currentTask,"task-preview");return t.params&&(t.params.preview_id=e),t},onAnnotationChanged:function(e){var t=e.preview,r=e.additions,i=e.deletions,n=e.updates,s=this.currentTask.id;this.updatePreviewAnnotation({taskId:s,preview:t,additions:r,deletions:i,updates:n})},onAddExtraPreviewClicked:function(){this.modals.addExtraPreview=!0},onRemoveExtraPreviewClicked:function(e){this.showRemoveExtraPreviewModal(e)},hideExtraPreviewModal:function(){this.modals.addExtraPreview=!1},showRemoveExtraPreviewModal:function(e){this.currentExtraPreviewId=e.id,this.modals.deleteExtraPreview=!0},hideRemoveExtraPreviewModal:function(){this.modals.deleteExtraPreview=!1},onAddPreviewClicked:function(){this.modals.addPreview=!0},closeAddPreviewModal:function(){this.modals.addPreview=!1},onDuplicateComment:function(e){this.$refs["add-comment"].setValue(e)},onPinComment:function(e){this.pinComment(e)},onEditComment:function(e){this.commentToEdit=e,this.modals.editComment=!0},onDeleteComment:function(e){this.commentToEdit=e,this.modals.deleteComment=!0},onCancelEditComment:function(e){this.modals.editComment=!1},onCancelDeleteComment:function(e){this.modals.deleteComment=!1},onTimeUpdated:function(e){this.currentTime=e},changeCurrentPreview:function(e){this.$router.push(this.previewPath(e.id))},onRemoteAcknowledge:function(e,t){if(this.currentTask){var r=this.currentTaskComments.find((function(t){return t.id===e.comment_id})),i=this.personMap.get(e.person_id);r&&i&&(this.user.id===i.id?("ack"===t&&!r.acknowledgements.includes(i.id)||"unack"===t&&r.acknowledgements.includes(i.id))&&this.$store.commit("ACK_COMMENT",{comment:r,user:i}):this.$store.commit("ACK_COMMENT",{comment:r,user:i}))}},isStatusChange:function(e){var t=this.currentTaskComments,r=t[e];return e===t.length-1||r.task_status_id!==t[e+1].task_status_id},timeCodeClicked:function(e){var t=this,r=e.versionRevision,i=(e.minutes,e.seconds,e.milliseconds,e.frame);this.changeCurrentPreview(this.currentTaskPreviews.find((function(e){return e.revision===parseInt(r)}))),setTimeout((function(){t.$refs["preview-player"].setCurrentFrame(i-1),t.$refs["preview-player"].focus()}),20)},extractAnnotationSnapshots:function(){var e=this;return E(b().mark((function t(){var r;return b().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$refs["add-comment"].showAnnotationLoading(),t.next=3,e.$refs["preview-player"].extractAnnotationSnapshots();case 3:return r=t.sent,e.$refs["add-comment"].setAnnotationSnapshots(r),e.$refs["add-comment"].hideAnnotationLoading(),t.abrupt("return",r);case 7:case"end":return t.stop()}}),t)})))()},isPreviewPlayerReadOnly:function(){if(this.currentTask){if(this.isCurrentUserManager||this.isCurrentUserClient)return!1;if(this.isCurrentUserSupervisor){if(0===this.user.departments.length)return!1;var e=this.taskTypeMap.get(this.currentTask.task_type_id);return!(e.department_id&&this.user.departments.includes(e.department_id))}}return!0}}),watch:{$route:function(){this.$route.params.task_id!==this.currentTask.id&&this.loadTaskData()},selectedPreviewId:function(){this.currentTask&&this.$router.push(this.previewPath(this.selectedPreviewId))}},socket:{events:{"preview-file:add-file":function(e){this.onPreviewAdded(e)},"comment:acknowledge":function(e){this.onRemoteAcknowledge(e,"ack")},"comment:unacknowledge":function(e){this.onRemoteAcknowledge(e,"unack")},"preview-file:update":function(e){var t=this.currentTaskComments.find((function(t){return t.previews&&t.previews.length>0&&t.previews[0].id===e.preview_file_id}));t&&this.currentTask&&this.refreshPreview({taskId:this.currentTask.id,previewId:e.preview_file_id}).then((function(e){t.previews[0].validation_status=e.validation_status}))},"comment:new":function(e){var t=this;setTimeout((function(){t.getCurrentTaskComments().length!==t.currentTaskComments.length&&(t.currentTaskComments=t.getCurrentTaskComments(),t.currentTaskPreviews=t.getCurrentTaskPreviews())}),1e3)},"comment:reply":function(e){if(this.currentTask){var t=this.currentTaskComments.find((function(t){return t.id===e.comment_id}));if(t){t.replies||(t.replies=[]);var r=t.replies.find((function(t){return t.id===e.reply_id}));r||this.refreshComment({taskId:this.currentTask.id,commentId:e.comment_id}).then((function(e){t.replies=e.replies})).catch(console.error)}}},"comment:delete-reply":function(e){if(this.currentTask){var t=this.currentTaskComments.find((function(t){return t.id===e.comment_id}));t&&(t.replies||(t.replies=[]),this.$store.commit("REMOVE_REPLY_FROM_COMMENT",{comment:t,reply:{id:e.reply_id}}))}}}},metaInfo:function(){var e="Loading task... - Kitsu";if(this.currentTask){var t=this.taskTypeMap.get(this.currentTask.task_type_id).name;e="".concat(this.title," / ").concat(t," - Kitsu")}return{title:e}}},j=$,A=(r("a22c"),r("2877")),M=Object(A["a"])(j,i,n,!1,null,"5e66f6ce",null);t["default"]=M.exports},a22c:function(e,t,r){"use strict";r("5715")},e861:function(e,t,r){"use strict";r("73d3")}}]);
//# sourceMappingURL=chunk-188a8ea2.1b2dc879.js.map