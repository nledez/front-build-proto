(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-db4c85ec"],{"004b":function(e,t,s){},"23f2":function(e,t,s){"use strict";s("004b")},a01b:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"page",staticClass:"columns fixed-page"},[s("div",{staticClass:"column main-column"},[s("div",{staticClass:"person page"},[s("div",{ref:"header",staticClass:"flexrow page-header"},[e.person?s("div",{staticClass:"flexrow-item"},[s("people-avatar",{attrs:{person:e.person,size:80,"font-size":30,"is-text":!1}})],1):e._e(),s("div",{staticClass:"flexrow-item"},[s("page-title",{attrs:{text:e.person?e.person.name:""}})],1)]),s("div",{ref:"tabs",staticClass:"task-tabs tabs"},[e.person?s("ul",[s("li",{class:{"is-active":e.isActiveTab("todos")}},[s("router-link",{attrs:{to:{name:"person",params:{person_id:e.person.id}}}},[e._v(" "+e._s(e.$t("tasks.current"))+" ")])],1),s("li",{class:{"is-active":e.isActiveTab("done")}},[s("router-link",{attrs:{to:{name:"person-tab",params:{tab:"done",person_id:e.person.id}}}},[e._v(" "+e._s(e.$t("tasks.done"))+" ("+e._s(e.displayedPersonDoneTasks.length)+") ")])],1),e.isCurrentUserManager?s("li",{class:{"is-active":e.isActiveTab("timesheets")}},[s("router-link",{attrs:{to:{name:"person-tab",params:{tab:"timesheets",person_id:e.person.id}}}},[e._v(" "+e._s(e.$t("timesheets.title"))+" ")])],1):e._e(),s("li",{class:{"is-active":e.isActiveTab("schedule")}},[s("router-link",{attrs:{to:{name:"person-tab",params:{tab:"schedule",person_id:e.person.id}}}},[e._v(" "+e._s(e.$t("schedule.title"))+" ")])],1)]):e._e()]),s("div",{ref:"search",staticClass:"flexrow"},[e.isActiveTab("done")?e._e():s("search-field",{ref:"person-tasks-search-field",class:{"search-field":!0,"flexrow-item":!0},attrs:{"can-save":!0},on:{change:e.onSearchChange,save:e.saveSearchQuery}}),s("span",{staticClass:"filler"}),s("combobox",{staticClass:"flexrow-item",attrs:{label:e.$t("main.sorted_by"),options:e.sortOptions,"locale-key-prefix":"tasks.fields."},model:{value:e.currentSort,callback:function(t){e.currentSort=t},expression:"currentSort"}})],1),s("div",{ref:"query"},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.isActiveTab("todos")||e.isActiveTab("timesheets"),expression:"isActiveTab('todos') || isActiveTab('timesheets')"}],staticClass:"query-list"},[s("search-query-list",{attrs:{queries:e.personTaskSearchQueries},on:{"change-search":e.changeSearch,"remove-search":e.removeSearchQuery}})],1)]),e.isActiveTab("todos")?s("todos-list",{ref:"task-list",attrs:{tasks:e.sortedTasks,"is-loading":e.isTasksLoading,"is-error":e.isTasksLoadingError,"selection-grid":e.personTaskSelectionGrid},on:{scroll:e.setPersonTasksScrollPosition}}):e._e(),e.isActiveTab("done")?s("todos-list",{ref:"done-list",attrs:{tasks:e.displayedPersonDoneTasks,"is-loading":e.isTasksLoading,"is-error":e.isTasksLoadingError,done:!0,selectionGrid:e.personTaskSelectionGrid}}):e._e(),e.isActiveTab("timesheets")?s("timesheet-list",{attrs:{tasks:e.loggablePersonTasks,"done-tasks":e.loggableDoneTasks,"is-loading":e.isTasksLoading,"is-error":e.isTasksLoadingError,"time-spent-map":e.personTimeSpentMap,"time-spent-total":e.personTimeSpentTotal,"hide-done":e.personTasksSearchText.length>0,"hide-day-off":!(e.isCurrentUserAdmin||this.user.id==this.person.id)},on:{"date-changed":e.onDateChanged,"time-spent-change":e.onTimeSpentChange,"set-day-off":e.onSetDayOff,"unset-day-off":e.onUnsetDayOff}}):e._e(),e.isActiveTab("schedule")?s("div",[e.scheduleItems.length>0?s("schedule",{ref:"schedule-widget",attrs:{"start-date":e.tasksStartDate,"end-date":e.tasksEndDate,hierarchy:e.scheduleItems,"zoom-level":2,height:e.scheduleHeight,"is-loading":e.isTasksLoading,"is-estimation-linked":!0,"with-milestones":!1}}):s("div",{staticClass:"has-text-centered"},[e._v(" There is no tasks scheduled for current person. ")])],1):e._e()],1)]),1===e.nbSelectedTasks?s("div",{staticClass:"column side-column"},[s("task-info",{attrs:{task:e.selectedTasks.values().next().value}})],1):e._e()])},r=[],n=s("7f45"),i=s.n(n),o=s("ceca"),c=s.n(o),d=s("2f62"),l=s("31f2"),u=s("7930"),h=s("3657"),f=s("992f"),p=s("8d07"),m=s("eb8c"),T=s("d7c7"),k=s("4d04"),v=s("55ce"),b=s("b11e"),_=s("e739"),y=s("9d94");function g(e){return P(e)||O(e)||D(e)||S()}function S(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function D(e,t){if(e){if("string"===typeof e)return j(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?j(e,t):void 0}}function O(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function P(e){if(Array.isArray(e))return j(e)}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,a=new Array(t);s<t;s++)a[s]=e[s];return a}function w(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function A(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?w(Object(s),!0).forEach((function(t){$(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):w(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function $(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var C={name:"person",mixins:[l["a"]],components:{Combobox:f["a"],PageTitle:p["a"],PeopleAvatar:m["a"],Schedule:T["a"],SearchField:k["a"],SearchQueryList:v["a"],TaskInfo:y["default"],TodosList:_["a"],TimesheetList:b["a"]},data:function(){return{activeTab:"todos",currentSort:"entity_name",isTasksLoading:!1,isTasksLoadingError:!1,person:null,scheduleHeight:0,selectedDate:i()().format("YYYY-MM-DD"),sortOptions:["entity_name","priority","task_status_short_name","start_date","due_date","estimation","last_comment_date"].map((function(e){return{label:e,value:e}}))}},mounted:function(){var e=this;this.updateActiveTab(),this.personTasksSearchText.length>0&&this.searchField.setValue(this.personTasksSearchText),setTimeout((function(){e.searchField&&e.searchField.focus()}),100),this.loadPerson(this.$route.params.person_id),window.addEventListener("resize",this.resetScheduleHeight)},afterDestroy:function(){window.removeEventListener("resize",this.resetScheduleHeight),this.$store.commit("LOAD_PERSON_TASKS_END",{tasks:[],userFilters:{},taskTypeMap:this.taskTypeMap})},computed:A(A({},Object(d["c"])(["displayedPersonTasks","displayedPersonDoneTasks","isCurrentUserAdmin","isCurrentUserManager","nbSelectedTasks","personMap","personTasksScrollPosition","personTasksSearchText","personTaskSearchQueries","personTaskSelectionGrid","personTimeSpentMap","personTimeSpentTotal","productionMap","selectedTasks","taskTypeMap","user"])),{},{loggablePersonTasks:function(){var e=this;return this.displayedPersonTasks.filter((function(t){return e.taskTypeMap.get(t.task_type_id).allow_timelog}))},loggableDoneTasks:function(){var e=this;return this.displayedPersonDoneTasks.filter((function(t){return e.taskTypeMap.get(t.task_type_id).allow_timelog}))},searchField:function(){return this.$refs["person-tasks-search-field"]},taskList:function(){return this.$refs["task-list"]},haveDoneList:function(){return this.$refs["done-list"]},sortedTasks:function(){var e="entity_name"===this.currentSort,t="priority"===this.currentSort,s="due_date"===this.currentSort,a="start_date"===this.currentSort,r=g(this.displayedPersonTasks);return e?r.sort(c()("project_name").thenBy("task_type_name").thenBy("full_entity_name")):t?r.sort(c()("priority",-1).thenBy((function(e,t){return e.due_date?t.due_date?e.due_date.localeCompare(t.due_date):-1:1})).thenBy("project_name").thenBy("task_type_name").thenBy("entity_name")):s?r.sort(c()((function(e,t){return e.due_date?t.due_date?e.due_date.localeCompare(t.due_date):-1:1})).thenBy("project_name").thenBy("task_type_name").thenBy("entity_name")):a?r.sort(c()((function(e,t){return e.start_date?t.start_date?e.start_date.localeCompare(t.start_date):-1:1})).thenBy("project_name").thenBy("task_type_name").thenBy("entity_name")):r.sort(c()(this.currentSort,-1).thenBy("project_name").thenBy("task_type_name").thenBy("entity_name"))},tasksStartDate:function(){return this.scheduleItems.length>0?Object(h["l"])(this.scheduleTasks):i()()},tasksEndDate:function(){return this.scheduleItems.length>0?Object(h["m"])(this.scheduleTasks):i()().add(15,"days")},scheduleTasks:function(){var e=[];return this.scheduleItems.forEach((function(t){e=e.concat(t.children)})),e},scheduleItems:function(){var e=this,t=new Map;this.sortedTasks.forEach((function(s){if(!t.get(s.project_id)){var a=e.productionMap.get(s.project_id),r=e.buildProjectScheduleItem(a);t.set(s.project_id,r)}var n=t.get(s.project_id),i=e.buildTaskScheduleItem(n,s);i&&n.children.push(i)}));var s=Array.from(t.values());return s.forEach((function(t){var s=i()(),a=i()().add(1,"days"),r=0;t.children.length>0&&(s=Object(h["l"])(t.children),a=Object(h["m"])(t.children)),t.children.forEach((function(t){var s=e.formatDuration(t.estimation);s&&(r+=t.estimation)})),Object.assign(t,{startDate:s,endDate:a,man_days:r})})),s}}),methods:A(A({},Object(d["b"])(["loadPersonTasks","setPersonTasksSearch","savePersonTasksSearch","removePersonTasksSearch","setDayOff","setPersonTasksScrollPosition","setTimeSpent","unsetDayOff"])),{},{resetScheduleHeight:function(){var e=this;this.$nextTick((function(){if(e.isActiveTab("schedule")){var t=e.$refs.page.offsetHeight,s=e.$refs.header.offsetHeight,a=e.$refs.tabs.offsetHeight,r=e.$refs.search.offsetHeight,n=e.$refs.query.offsetHeight;e.scheduleHeight=t-s-a-r-n,e.$refs["schedule-widget"]&&e.$refs["schedule-widget"].resetScheduleSize()}}))},buildProjectScheduleItem:function(e){return A(A({},e),{},{avatar:!0,color:u["a"].fromString(e.name,!0),priority:1,expanded:!0,loading:!1,children:[],editable:!1})},buildTaskScheduleItem:function(e,t){var s,a=i()();if(!t.start_date&&!t.real_start_date&&!t.due_date&&!t.end_date)return null;t.start_date?a=Object(h["t"])(t.start_date):t.real_start_date&&(a=Object(h["t"])(t.real_start_date));var r=this.formatDuration(t.estimation);t.due_date?s=Object(h["t"])(t.due_date):t.end_date?s=Object(h["t"])(t.end_date):t.estimation&&(s=a.clone().add(r,"days")),s&&!s.isBefore(a)||(s=a.clone().add(1,"days"));var n=this.taskTypeMap.get(t.task_type_id);return A(A({},t),{},{name:t.full_entity_name+" / "+n.name,startDate:a,endDate:s,expanded:!1,loading:!1,man_days:r,editable:!1,unresizable:!1,parentElement:e,color:n.color,children:[]})},isActiveTab:function(e){return this.activeTab===e},selectTab:function(e){var t=this;this.activeTab=e,this.isActiveTab("todos")&&setTimeout((function(){t.searchField&&t.searchField.focus()}),100)},onSearchChange:function(e){this.setPersonTasksSearch(e)},loadPerson:function(e){var t=this;this.person=this.personMap.get(e),this.isTasksLoading=!0,this.loadPersonTasks({personId:this.person.id,date:this.selectedDate,callback:function(e){e&&console.error(e),t.isTasksLoading=!1,t.isTasksLoadingError=!1,setTimeout((function(){t.taskList&&t.$nextTick((function(){t.taskList.setScrollPosition(t.personTasksScrollPosition)})),t.resizeHeaders()}),0)}})},resizeHeaders:function(){var e=this;this.$nextTick((function(){e.taskList&&e.taskList.resizeHeaders(),e.haveDoneList&&e.haveDoneList.resizeHeaders()}))},selectCurrent:function(){var e=this;this.activeTab="current",setTimeout((function(){e.$refs["person-tasks-search-field"].focus()}),100)},selectDone:function(){this.activeTab="done"},changeSearch:function(e){this.$refs["person-tasks-search-field"].setValue(e.search_query),this.$refs["person-tasks-search-field"].$emit("change",e.search_query)},saveSearchQuery:function(e){this.savePersonTasksSearch(e).then((function(){})).catch((function(e){e&&console.error(e)}))},removeSearchQuery:function(e){this.removePersonTasksSearch(e).then((function(){})).catch((function(e){e&&console.error(e)}))},updateActiveTab:function(){var e=["done","timesheets","schedule"];e.includes(this.$route.params.tab)?this.activeTab=this.$route.params.tab:this.activeTab="todos"},onTimeSpentChange:function(e){e.personId=this.person.id,e.date=this.selectedDate,this.setTimeSpent(e)},onDateChanged:function(e){this.selectedDate=i()(e).format("YYYY-MM-DD"),this.loadPerson(this.person.id)},onSetDayOff:function(){var e={personId:this.person.id,date:this.selectedDate};this.setDayOff(e)},onUnsetDayOff:function(){var e={personId:this.person.id,date:this.selectedDate};this.unsetDayOff(e)}}),metaInfo:function(){return{title:this.person?"".concat(this.person.name," - Kitsu"):"... - Kitsu"}},watch:{$route:function(){var e=this.$route.params.person_id;this.updateActiveTab(),this.person.id!==e&&this.loadPerson()},activeTab:function(){this.resetScheduleHeight()}}},x=C,L=(s("23f2"),s("2877")),E=Object(L["a"])(x,a,r,!1,null,"1886906e",null);t["default"]=E.exports}}]);
//# sourceMappingURL=chunk-db4c85ec.5e92b9b4.js.map